global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    environment: "${ENVIRONMENT}"

scrape_configs:
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  - job_name: "node-exporter"
    static_configs:
      - targets: ["rwa-${ENVIRONMENT}-node-exporter:9100"]
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
      - source_labels: [__meta_docker_container_label_com_rwa_service]
        target_label: service_name
      - source_labels: [__meta_docker_container_label_com_rwa_environment]
        target_label: environment
      - action: labelmap
        regex: __meta_docker_container_label_(.+)
        replacement: $1

  - job_name: "docker-containers"
    static_configs:
      - targets: ["rwa-${ENVIRONMENT}-postgres:5432"]
        labels:
          container_name: rwa-${ENVIRONMENT}-postgres
      - targets: ["rwa-${ENVIRONMENT}-redis:6379"]
        labels:
          container_name: rwa-${ENVIRONMENT}-redis
      - targets: ["rwa-${ENVIRONMENT}-foundry:8545"]
        labels:
          container_name: rwa-${ENVIRONMENT}-foundry
      - targets: ["rwa-${ENVIRONMENT}-backend:8000"]
        labels:
          container_name: rwa-${ENVIRONMENT}-backend
      - targets: ["rwa-${ENVIRONMENT}-frontend:5173"]
        labels:
          container_name: rwa-${ENVIRONMENT}-frontend
      - targets: ["rwa-${ENVIRONMENT}-cypress:3000"]
        labels:
          container_name: rwa-${ENVIRONMENT}-cypress
      - targets: ["rwa-${ENVIRONMENT}-detox:4723"]
        labels:
          container_name: rwa-${ENVIRONMENT}-detox
      - targets: ["rwa-${ENVIRONMENT}-nginx:80"]
        labels:
          container_name: rwa-${ENVIRONMENT}-nginx
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
